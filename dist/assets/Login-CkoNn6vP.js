import{r as v,l as F,h as L,z as k,B as u,R as s,L as N,J as r,al as d,aB as E,A as w,O as c}from"./vendor-DdeEpjzh.js";import{u as P}from"./index-CpOMcLEY.js";import{a as U}from"./index-ID-G45V4.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as g,a as q}from"./element-DkRX-ly5.js";const J={class:"login-container"},O={class:"login-form-wrapper"},z={class:"button-container"},A={key:0,class:"error-message"},j={__name:"Login",setup(D){const f=v(null),l=F({username:"",password:"",rememberMe:!1}),S={username:[{required:!0,message:"请输入账号信息",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},a=v(!1),p=v(""),b=E();L(()=>{M()});const y=async()=>{f.value.validate(async m=>{if(m){const e=q.service({lock:!0,text:"登录中...",background:"rgba(0, 0, 0, 0.7)"});p.value="";try{const o=await U.user.login(l);if(o&&o.code===1){const t=P();console.log("登录响应数据:",o.data),console.log("token是否存在于响应中:",o.data.token?"是":"否"),t.login(o.data),localStorage.setItem("userInfo",JSON.stringify(o.data)),console.log("userInfo已存储到localStorage"),localStorage.setItem("token",o.data.token),console.log("token已单独存储到localStorage:",o.data.token);const _=o.data.role===0?"admin":"user";localStorage.setItem("role",_),localStorage.setItem("userId",o.data.user?.id||"");const n=localStorage.getItem("token");console.log("验证token存储结果:",n?"成功":"失败"),l.rememberMe?R():C(),g.success("登录成功"),t.role==="admin"?b.push("/admin/home"):b.push("/user/home")}else g.error("登录失败："+(o?.msg||o?.message||"用户名或密码错误"))}catch(o){console.error("登录请求失败:",o),o.response&&o.response.data?g.error("登录失败："+(o.response.data.msg||o.response.data.message||"用户名或密码错误")):g.error("登录失败：用户名或密码错误")}finally{setTimeout(()=>{e.close()},300),a.value=!1}}})},I=()=>{f.value.resetFields(),p.value=""},V=()=>{g("密码重置功能开发中")},x=()=>{b.push("/register")},R=()=>{localStorage.setItem("remembered_username",l.username)},M=()=>{const m=localStorage.getItem("remembered_username");m&&(l.username=m,l.rememberMe=!0)},C=()=>{localStorage.removeItem("remembered_username")};return(m,e)=>{const o=d("el-input"),t=d("el-form-item"),_=d("el-checkbox"),n=d("el-button"),h=d("el-form"),B=d("el-alert");return w(),k("div",J,[u("div",O,[e[9]||(e[9]=u("div",{class:"login-header"},[u("h2",null,"老年人健康服务平台")],-1)),s(h,{model:l,rules:S,ref_key:"loginFormRef",ref:f,class:"login-form"},{default:r(()=>[s(t,{label:"账号",prop:"username",class:"login-form-item"},{default:r(()=>[s(o,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=i=>l.username=i),placeholder:"请输入账号",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(t,{label:"密码",prop:"password",class:"login-form-item"},{default:r(()=>[s(o,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=i=>l.password=i),type:"password",placeholder:"请输入密码","show-password":"",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(t,{class:"login-form-item remember-password text-center"},{default:r(()=>[s(_,{modelValue:l.rememberMe,"onUpdate:modelValue":e[2]||(e[2]=i=>l.rememberMe=i)},{default:r(()=>[...e[3]||(e[3]=[c("记住密码",-1)])]),_:1},8,["modelValue"]),e[5]||(e[5]=u("br",null,null,-1)),s(n,{type:"text",onClick:V,disabled:a.value},{default:r(()=>[...e[4]||(e[4]=[c("忘记密码？",-1)])]),_:1},8,["disabled"])]),_:1}),s(t,{class:"login-form-item login-button-group"},{default:r(()=>[u("div",z,[s(n,{type:"primary",onClick:y,loading:a.value,class:"login-btn"},{default:r(()=>[...e[6]||(e[6]=[c(" 登录 ",-1)])]),_:1},8,["loading"]),s(n,{onClick:I,disabled:a.value,class:"reset-btn"},{default:r(()=>[...e[7]||(e[7]=[c(" 重置 ",-1)])]),_:1},8,["disabled"])])]),_:1}),s(t,{class:"login-form-item"},{default:r(()=>[s(n,{type:"text",onClick:x,disabled:a.value},{default:r(()=>[...e[8]||(e[8]=[c(" 还没有账号？立即注册 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),p.value?(w(),k("div",A,[s(B,{title:p.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):N("",!0)])])}}},X=T(j,[["__scopeId","data-v-2f45c1e0"]]);export{X as default};
