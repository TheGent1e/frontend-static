import{a as y}from"./index-ID-G45V4.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as d,b as $}from"./element-DkRX-ly5.js";import{r as v,h as se,z as q,B as s,R as a,J as n,al as g,ar as de,A as x,K as ie,Q as ue,a5 as me,I as F,O as f,P as U,n as P}from"./vendor-DdeEpjzh.js";const pe={class:"employee-management"},ce={class:"card-header"},ve={class:"header-buttons"},ge={class:"dialog-footer"},fe={class:"search-bar"},be={class:"search-container"},he={class:"form-grid"},_e={class:"form-column"},ye={class:"form-column"},we={class:"form-row"},Ve={class:"button-group"},Ie={class:"pagination"},Ne={__name:"EmployeeManagement",setup(Ce){const V=v(1),D=v(10),S=v(0),k=v(!1),u=v({name:"",gender:"",position:"",departmentName:""}),I=v([]),z=v([{id:1,name:"张三",position:"技术经理",departmentName:"技术部",phone:"138****1234",status:"1"},{id:2,name:"李四",position:"客服专员",departmentName:"客服部",phone:"139****5678",status:"1"},{id:3,name:"王五",position:"财务会计",departmentName:"财务部",phone:"158****8888",status:"0"},{id:4,name:"赵六",position:"行政助理",departmentName:"行政部",phone:"188****9999",status:"1"},{id:5,name:"钱七",position:"市场推广",departmentName:"市场部",phone:"177****6666",status:"1"},{id:6,name:"孙八",position:"人力资源专员",departmentName:"人力资源部",phone:"166****5555",status:"0"}]),_=v([]),w=v(!1),E=v("添加员工"),N=v(),r=v({id:null,name:"",gender:"0",position:"",departmentId:0,phone:"",status:"1"}),R=v({name:[{required:!0,message:"请输入员工姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],position:[{required:!0,message:"请输入职位",trigger:"blur"}],departmentId:[{required:!0,message:"请选择所属部门",trigger:"change"}],phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]}),m=v([]),B=async()=>{try{console.log("开始加载部门数据..."),console.log("调用API: api.admin.findDeptIdAndName()");const l=await y.admin.findDeptIdAndName();if(console.log("部门数据API响应:",l),console.log("API响应对象:",l),!l)throw new Error("API返回了空响应");if(l.code===1||l.code===200)console.log("API调用成功，状态码:",l.code),l.data?typeof l.data=="object"&&!Array.isArray(l.data)&&!l.data.rows?(m.value=Object.entries(l.data).map(([e,o])=>({id:Number(e),name:o})),console.log("部门数据(Map格式)加载成功，共",m.value.length,"个部门"),console.log("部门完整数据：",m.value),console.log("每个部门的id和name：",m.value.map(e=>`id: ${e.id}, name: ${e.name}`))):Array.isArray(l.data)?(m.value=l.data,console.log("部门数据(数组格式)加载成功，共",l.data.length,"个部门"),console.log("部门完整数据：",m.value)):Array.isArray(l.data.rows)?(m.value=l.data.rows,console.log("部门数据(rows格式)加载成功，共",l.data.rows.length,"个部门")):(console.warn("部门数据格式异常，使用默认数据"),m.value=[{id:1,name:"体检科"},{id:2,name:"社区医疗"},{id:3,name:"内科"},{id:4,name:"内分泌科"},{id:5,name:"心内科"}]):(console.warn("部门数据为空，使用默认数据"),m.value=[{id:1,name:"体检科"},{id:2,name:"社区医疗"},{id:3,name:"内科"},{id:4,name:"内分泌科"},{id:5,name:"心内科"}]);else{const e=l.msg||"加载部门数据失败";console.error("部门数据加载失败:",e),d.error(e),m.value=[{id:1,name:"体检科"},{id:2,name:"社区医疗"},{id:3,name:"内科"},{id:4,name:"内分泌科"},{id:5,name:"心内科"}]}}catch(l){console.error("加载部门数据异常:",l),d.error("网络错误或后端服务异常，请稍后重试"),m.value=[{id:1,name:"体检科"},{id:2,name:"社区医疗"},{id:3,name:"内科"},{id:4,name:"内分泌科"},{id:5,name:"心内科"}]}},h=async()=>{k.value=!0;try{const l={page:V.value,pageSize:D.value,name:u.value.name,gender:u.value.gender?Number(u.value.gender):void 0,position:u.value.position,departmentName:u.value.departmentName,begin:I.value[0],end:I.value[1]},e={};Object.keys(l).forEach(p=>{l[p]!==void 0&&l[p]!==""&&(e[p]=l[p])});const o=await y.admin.getEmployees(e);o.code===1?(z.value=o.data.rows,S.value=o.data.total):d.error(o.msg||"加载数据失败")}catch(l){console.error("加载员工数据失败",l),d.error("网络错误，请稍后重试")}finally{k.value=!1}},j=()=>{V.value=1,h()},O=()=>{u.value={name:"",gender:"",position:"",departmentName:""},I.value=[],V.value=1,h()},Y=async()=>{E.value="添加员工",r.value={id:null,name:"",gender:"0",position:"",departmentId:0,phone:"",status:"1"},await P(),setTimeout(()=>{w.value=!0},50)},Q=async()=>{if(N.value)try{await N.value.validate();const l={...r.value,departmentId:r.value.departmentId?Number(r.value.departmentId):null,gender:Number(r.value.gender),status:Number(r.value.status)};let e,o;if(r.value.id)e=await y.admin.updateEmployee(l),o="编辑员工成功";else{const i=new Date().toISOString().split(".")[0],c={...l,createdAt:i,updatedAt:i};e=await y.admin.addEmployee(c),o="添加员工成功"}e.code===1||e.code===200?(d.success(o),w.value=!1,setTimeout(()=>{h()},300)):d.error(e.msg||"操作失败")}catch(l){console.error("操作失败",l),d.error("操作失败，请稍后重试")}},J=async l=>{try{E.value="编辑员工",m.value.length===0&&await B();const e=await y.admin.findEmpbyId(l.id);if(e.code===1){const o=e.data;if(r.value={id:o.id,name:o.name,gender:o.gender||"0",position:o.position,departmentId:Number(o.departmentId)||0,phone:o.phone,status:o.status||"1"},o.departmentId){const p=Number(o.departmentId);if(!m.value.some(c=>c.id===p)&&o.departmentName){console.log(`创建临时部门对象，ID: ${o.departmentId}, 名称: ${o.departmentName}`);const c={id:p,name:o.departmentName};m.value.push(c)}}await P(),setTimeout(()=>{w.value=!0},50)}else d.error(e.msg||"获取员工信息失败")}catch(e){console.error("获取员工信息失败",e),d.error("获取员工信息失败，请稍后重试")}},K=l=>{$.confirm("确定要删除该员工吗？删除后数据将无法恢复！","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await y.admin.deleteEmployee([l]);e.code===1||e.code===200?(d.success("删除成功"),h()):d.error(e.msg||"删除失败")}catch(e){console.error("删除员工失败",e),d.error("删除失败，请稍后重试")}}).catch(()=>{})},L=async l=>{const e=l.status;try{d.success("状态更新成功")}catch(o){l.status=e,console.error("更新员工状态失败",o),d.error("更新失败，请稍后重试")}},W=l=>{D.value=l,h()},G=l=>{V.value=l,h()},H=l=>{_.value=l.map(e=>e.id)},X=()=>(N.value&&N.value.resetFields(),!0),Z=()=>{if(_.value.length===0){d.warning("请选择要删除的员工");return}$.confirm(`确定要删除选中的 ${_.value.length} 名员工吗？删除后数据将无法恢复！`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await y.admin.deleteEmployee(_.value);l.code===1||l.code===200?(d.success("批量删除成功"),_.value=[],h()):d.error(l.msg||"批量删除失败")}catch(l){console.error("批量删除员工失败",l),d.error("批量删除失败，请稍后重试")}}).catch(()=>{})};return se(()=>{B().then(()=>{h()})}),(l,e)=>{const o=g("el-button"),p=g("el-input"),i=g("el-form-item"),c=g("el-option"),A=g("el-select"),M=g("el-switch"),T=g("el-form"),ee=g("el-dialog"),ae=g("el-date-picker"),b=g("el-table-column"),le=g("el-table"),te=g("el-pagination"),oe=g("el-card"),ne=de("loading");return x(),q("div",pe,[e[22]||(e[22]=s("div",{class:"page-header"},[s("h2",null,"员工信息管理"),s("p",null,"管理系统中的所有员工信息")],-1)),a(oe,{class:"content-card shadow-card"},{header:n(()=>[s("div",ce,[e[15]||(e[15]=s("span",null,"员工列表",-1)),s("div",ve,[a(o,{type:"danger",onClick:Z,plain:"",disabled:_.value.length===0},{default:n(()=>[e[13]||(e[13]=s("i",{class:"el-icon-delete"},null,-1)),f(" 批量删除 ("+U(_.value.length)+") ",1)]),_:1},8,["disabled"]),a(o,{type:"primary",onClick:Y,plain:""},{default:n(()=>[...e[14]||(e[14]=[s("i",{class:"el-icon-plus"},null,-1),f(" 添加员工 ",-1)])]),_:1})])])]),default:n(()=>[a(ee,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=t=>w.value=t),title:E.value,width:"600px","close-on-click-modal":!1,class:"employee-dialog","append-to-body":!0,onClose:X},{footer:n(()=>[s("div",ge,[a(o,{onClick:e[6]||(e[6]=t=>w.value=!1)},{default:n(()=>[...e[16]||(e[16]=[f("取消",-1)])]),_:1}),a(o,{type:"primary",onClick:Q},{default:n(()=>[...e[17]||(e[17]=[f("确定",-1)])]),_:1})])]),default:n(()=>[a(T,{ref_key:"employeeFormRef",ref:N,model:r.value,rules:R.value,"label-width":"100px","label-position":"right",class:"dialog-form"},{default:n(()=>[a(i,{label:"员工姓名",prop:"name"},{default:n(()=>[a(p,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.name=t),placeholder:"请输入员工姓名"},null,8,["modelValue"])]),_:1}),a(i,{label:"性别",prop:"gender"},{default:n(()=>[a(A,{modelValue:r.value.gender,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.gender=t),placeholder:"请选择性别"},{default:n(()=>[a(c,{label:"未知",value:0}),a(c,{label:"男",value:1}),a(c,{label:"女",value:2})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"职位",prop:"position"},{default:n(()=>[a(p,{modelValue:r.value.position,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.position=t),placeholder:"请输入职位"},null,8,["modelValue"])]),_:1}),a(i,{label:"所属部门",prop:"departmentId"},{default:n(()=>[a(A,{modelValue:r.value.departmentId,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.departmentId=t),placeholder:"请选择部门"},{default:n(()=>[(x(!0),q(ue,null,me(m.value,t=>(x(),F(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"联系电话",prop:"phone"},{default:n(()=>[a(p,{modelValue:r.value.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.phone=t),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:n(()=>[a(M,{modelValue:r.value.status,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.status=t),"active-value":"1","inactive-value":"0","active-text":"在职","inactive-text":"离职","active-color":"#67c23a","inactive-color":"#dcdfe6"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),s("div",fe,[s("div",be,[a(T,{inline:!1,model:u.value,class:"demo-form","label-width":"80px"},{default:n(()=>[s("div",he,[s("div",_e,[a(i,{label:"员工姓名"},{default:n(()=>[a(p,{modelValue:u.value.name,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.name=t),placeholder:"请输入员工姓名",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"部门名称"},{default:n(()=>[a(p,{modelValue:u.value.departmentName,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.departmentName=t),placeholder:"请输入部门名称",clearable:""},null,8,["modelValue"])]),_:1})]),s("div",ye,[a(i,{label:"性别"},{default:n(()=>[a(A,{modelValue:u.value.gender,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.gender=t),placeholder:"请选择性别",clearable:""},{default:n(()=>[a(c,{label:"全部",value:""}),a(c,{label:"未知",value:"0"}),a(c,{label:"男",value:"1"}),a(c,{label:"女",value:"2"})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"职位"},{default:n(()=>[a(p,{modelValue:u.value.position,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.position=t),placeholder:"请输入职位",clearable:""},null,8,["modelValue"])]),_:1})])]),s("div",we,[a(i,{label:"创建时间",class:"date-range-item"},{default:n(()=>[a(ae,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=t=>I.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD","unlink-panels":!0,"range-picker-options":"",style:{width:"100%","max-width":"400px"}},null,8,["modelValue"])]),_:1}),a(i,{class:"button-item"},{default:n(()=>[s("div",Ve,[a(o,{type:"primary",onClick:j,class:"search-btn"},{default:n(()=>[...e[18]||(e[18]=[s("i",{class:"el-icon-search"},null,-1),f(" 搜索 ",-1)])]),_:1}),a(o,{onClick:O,class:"reset-btn"},{default:n(()=>[...e[19]||(e[19]=[s("i",{class:"el-icon-refresh"},null,-1),f(" 重置 ",-1)])]),_:1})])]),_:1})])]),_:1},8,["model"])])]),ie((x(),F(le,{data:z.value,style:{width:"100%"},"header-cell-style":{backgroundColor:"#f7f9fc",fontWeight:"bold"},"row-class-name":"employee-row","row-key":"id",onSelectionChange:H},{default:n(()=>[a(b,{type:"selection",width:"55"}),a(b,{prop:"id",label:"员工ID",width:"80"}),a(b,{prop:"name",label:"员工姓名"}),a(b,{prop:"gender",label:"性别"},{default:n(t=>[f(U(t.row.gender==="1"?"男":t.row.gender==="2"?"女":"未知"),1)]),_:1}),a(b,{prop:"position",label:"职位"}),a(b,{prop:"departmentName",label:"所属部门"},{default:n(t=>[f(U(t.row.departmentId===0?"无":t.row.departmentName),1)]),_:1}),a(b,{prop:"phone",label:"联系电话"}),a(b,{prop:"status",label:"状态",width:"120"},{default:n(t=>[a(M,{modelValue:t.row.status,"onUpdate:modelValue":C=>t.row.status=C,"active-value":"1","inactive-value":"0","active-text":"在职","inactive-text":"离职",onChange:C=>L(t.row),"active-color":"#67c23a","inactive-color":"#dcdfe6"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(b,{label:"操作",width:"150",fixed:"right"},{default:n(t=>[a(o,{size:"small",onClick:C=>J(t.row),type:"primary",plain:""},{default:n(()=>[...e[20]||(e[20]=[f(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(o,{size:"small",type:"danger",onClick:C=>K(t.row.id)},{default:n(()=>[...e[21]||(e[21]=[f(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,k.value]]),s("div",Ie,[a(te,{"current-page":V.value,"page-size":D.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:W,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1})])}}},Ae=re(Ne,[["__scopeId","data-v-5e326070"]]);export{Ae as default};
