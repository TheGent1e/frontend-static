import{r,o as he,l as be,E as g,u as Ve,k as w,c as d,b as s,e as P,d as o,w as a,f as c,F as q,D as N,t as n,h as v,g as i,P as B,C as Ce,m as Ie,M as xe,n as De}from"./index-BFadyM4N.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";const qe={class:"checkout-container"},Ne={class:"checkout"},Se={class:"checkout-header"},Ue={key:0,class:"checkout-content"},Me={class:"checkout-section address-section"},$e={class:"section-header"},Oe={key:0,class:"address-list"},Ae=["onClick"],Pe={class:"address-info"},Be={class:"address-name-phone"},Fe={class:"address-name"},ze={class:"address-phone"},Re={class:"address-detail"},Te={class:"address-actions"},je={key:1,class:"no-address"},Ee={class:"checkout-section order-items-section"},Je={class:"order-items"},Le={class:"item-image"},Ge=["src","alt"],He={class:"item-info"},Ke={class:"item-name"},Qe={class:"item-specs"},We={class:"item-price"},Xe={class:"item-quantity"},Ye={class:"item-subtotal"},Ze={class:"checkout-section delivery-section"},et={class:"delivery-options"},tt={class:"delivery-desc"},st={key:0,class:"delivery-fee"},lt={class:"checkout-section payment-section"},ot={class:"payment-options"},at={class:"payment-icon"},nt={class:"checkout-section coupon-section"},it={key:0},dt={key:1},ut={class:"checkout-section remark-section"},rt={class:"checkout-section order-amount-section"},ct={class:"amount-item"},vt={class:"amount-item"},mt={key:0,class:"amount-item"},pt={class:"text-success"},_t={class:"amount-item total"},ft={class:"total-price"},gt={key:1,class:"loading-container"},kt={key:0,class:"checkout-footer"},yt={class:"footer-content"},ht={class:"total-info"},bt={class:"total-price"},Vt={class:"submit-section"},Ct={class:"address-dialog-content"},It={class:"address-form"},xt={class:"coupon-dialog-content"},Dt={key:0,class:"coupon-list"},wt=["onClick"],qt={class:"coupon-value"},Nt={class:"coupon-info"},St={class:"coupon-name"},Ut={class:"coupon-condition"},Mt={class:"coupon-expire"},$t={key:1,class:"no-coupon"},Ot={__name:"Checkout",setup(At){const S=Ve(),Q=be(),U=r(!1),F=r(!1),b=r([]),_=r([]),p=r(""),M=r([]),k=r(""),z=r([]),V=r(""),R=r([]),C=r(null),f=r(null),T=r(""),y=r(!1),I=r(!1),u=r({receiverName:"",phone:"",region:[],province:"",city:"",district:"",detail:"",isDefault:!1}),W={receiverName:[{required:!0,message:"è¯·è¾“å…¥æ”¶è´§äººå§“å",trigger:"blur"}],phone:[{required:!0,message:"è¯·è¾“å…¥æ‰‹æœºå·ç ",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ",trigger:"blur"}],region:[{required:!0,message:"è¯·é€‰æ‹©æ‰€åœ¨åœ°åŒº",trigger:"change"}],detail:[{required:!0,message:"è¯·è¾“å…¥è¯¦ç»†åœ°å€",trigger:"blur"}]},X=r([{value:"åŒ—äº¬å¸‚",label:"åŒ—äº¬å¸‚",children:[{value:"åŒ—äº¬å¸‚",label:"åŒ—äº¬å¸‚",children:[{value:"æœé˜³åŒº",label:"æœé˜³åŒº"},{value:"æµ·æ·€åŒº",label:"æµ·æ·€åŒº"},{value:"ä¸œåŸåŒº",label:"ä¸œåŸåŒº"}]}]},{value:"ä¸Šæµ·å¸‚",label:"ä¸Šæµ·å¸‚",children:[{value:"ä¸Šæµ·å¸‚",label:"ä¸Šæµ·å¸‚",children:[{value:"æµ¦ä¸œæ–°åŒº",label:"æµ¦ä¸œæ–°åŒº"},{value:"é»„æµ¦åŒº",label:"é»„æµ¦åŒº"}]}]}]);he(()=>{Y()});const Y=async()=>{U.value=!0;try{const l=sessionStorage.getItem("checkoutParams");if(l){const m=JSON.parse(l);b.value=Z(m)}else{const{productId:m,quantity:E}=Q.query;if(m)b.value=ee({productId:m,quantity:E});else{g.warning("è¯·ä»è´­ç‰©è½¦æˆ–å•†å“è¯¦æƒ…é¡µè¿›å…¥ç»“ç®—"),S.push("/user/mall");return}}_.value=te();const e=_.value.find(m=>m.isDefault);e?p.value=e.id:_.value.length>0&&(p.value=_.value[0].id),M.value=se(),k.value=M.value[0].id,z.value=le(),V.value=z.value[0].id,R.value=oe()}catch(l){console.error("åŠ è½½ç»“ç®—æ•°æ®å¤±è´¥",l),g.error("åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{U.value=!1}},Z=l=>[{id:1,productId:1,name:"æ™ºèƒ½è¡€å‹è®¡å®¶ç”¨ä¸Šè‡‚å¼å…¨è‡ªåŠ¨æµ‹é‡ä»ª",image:"/images/products/blood-pressure.jpg",price:299,quantity:1,specs:{é¢œè‰²:"ç™½è‰²",å‹å·:"BP-3000"},subtotal:299},{id:2,productId:2,name:"å®¶ç”¨è¡€ç³–ä»ªå¥—è£…ç²¾å‡†æµ‹è¡€ç³–ä»ªå™¨",image:"/images/products/blood-sugar.jpg",price:199,quantity:2,specs:{è§„æ ¼:"50è¯•çº¸",å“ç‰Œ:"å¥åº·å«å£«"},subtotal:398}],ee=l=>[{id:1,productId:l.productId,name:"æ™ºèƒ½è¡€å‹è®¡å®¶ç”¨ä¸Šè‡‚å¼å…¨è‡ªåŠ¨æµ‹é‡ä»ª",image:"/images/products/blood-pressure.jpg",price:299,quantity:l.quantity||1,specs:{é¢œè‰²:"ç™½è‰²",å‹å·:"BP-3000"},subtotal:299*(l.quantity||1)}],te=()=>[{id:"1",receiverName:"å¼ ä¸‰",phone:"13800138000",province:"åŒ—äº¬å¸‚",city:"åŒ—äº¬å¸‚",district:"æœé˜³åŒº",detail:"æŸæŸè¡—é“æŸæŸå°åŒº1å·æ¥¼101å®¤",isDefault:!0},{id:"2",receiverName:"æå››",phone:"13900139000",province:"ä¸Šæµ·å¸‚",city:"ä¸Šæµ·å¸‚",district:"æµ¦ä¸œæ–°åŒº",detail:"æŸæŸè·¯æŸæŸèŠ±å›­2å·æ¥¼202å®¤",isDefault:!1}],se=()=>[{id:"standard",name:"æ ‡å‡†é…é€",description:"3-5ä¸ªå·¥ä½œæ—¥é€è¾¾",fee:0},{id:"express",name:"åŠ æ€¥é…é€",description:"1-2ä¸ªå·¥ä½œæ—¥é€è¾¾",fee:15}],le=()=>[{id:"alipay",name:"æ”¯ä»˜å®",icon:"ğŸ’³"},{id:"wechat",name:"å¾®ä¿¡æ”¯ä»˜",icon:"ğŸ’³"},{id:"card",name:"é“¶è¡Œå¡æ”¯ä»˜",icon:"ğŸ’³"}],oe=()=>[{id:"1",name:"æ–°äººä¸“äº«ä¼˜æƒ åˆ¸",value:20,minSpend:100,expireDate:"2023-12-31"},{id:"2",name:"æ»¡300å‡50",value:50,minSpend:300,expireDate:"2023-12-31"}],$=w(()=>b.value.reduce((l,e)=>l+e.price*e.quantity,0)),J=w(()=>{const l=M.value.find(e=>e.id===k.value);return l?l.fee:0}),ae=w(()=>f.value?$.value>=f.value.minSpend:!1),j=w(()=>f.value&&ae.value?f.value.discount:0),L=w(()=>Math.max(0,$.value+J.value-j.value)),ne=l=>{l&&l.length>=3&&(u.value.province=l[0],u.value.city=l[1],u.value.district=l[2])},ie=async()=>{try{const l={id:Date.now().toString(),...u.value};_.value.push(l),u.value.isDefault&&_.value.forEach(e=>{e.id!==l.id&&(e.isDefault=!1)}),p.value=l.id,de(),y.value=!1,g.success("åœ°å€ä¿å­˜æˆåŠŸ")}catch(l){console.error("ä¿å­˜åœ°å€å¤±è´¥",l),g.error("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}},de=()=>{u.value={receiverName:"",phone:"",region:[],province:"",city:"",district:"",detail:"",isDefault:!1}},ue=l=>{if($.value<l.minSpend){g.warning(`è®¢å•é‡‘é¢éœ€æ»¡${l.minSpend}å…ƒæ‰èƒ½ä½¿ç”¨è¯¥ä¼˜æƒ åˆ¸`);return}C.value=l.id,f.value=l,I.value=!1},re=async()=>{if(!p.value){g.warning("è¯·é€‰æ‹©æ”¶è´§åœ°å€");return}try{F.value=!0;const l={addressId:p.value,deliveryId:k.value,paymentId:V.value,couponId:C.value,remark:T.value,items:b.value.map(e=>({productId:e.productId,quantity:e.quantity}))};await De.alert("è®¢å•æäº¤æˆåŠŸï¼å³å°†è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ã€‚","æäº¤æˆåŠŸ",{confirmButtonText:"ç¡®å®š",callback:()=>{S.push("/user/mall/orders"),sessionStorage.removeItem("checkoutParams")}})}catch(l){console.error("æäº¤è®¢å•å¤±è´¥",l),g.error("æäº¤è®¢å•å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{F.value=!1}},ce=l=>l?Object.entries(l).map(([e,m])=>`${e}: ${m}`).join(", "):"",ve=()=>{S.push("/user/mall")},me=()=>{S.push("/user/mall/cart")};return(l,e)=>{const m=c("el-breadcrumb-item"),E=c("el-breadcrumb"),h=c("el-button"),pe=c("el-tag"),O=c("el-radio"),G=c("el-empty"),H=c("el-radio-group"),_e=c("el-icon"),A=c("el-input"),fe=c("el-skeleton"),x=c("el-form-item"),ge=c("el-cascader"),ke=c("el-checkbox"),ye=c("el-form"),K=c("el-dialog");return i(),d("div",qe,[s("div",Ne,[s("div",Se,[e[20]||(e[20]=s("h2",null,"ç¡®è®¤è®¢å•",-1)),o(E,{separator:"/"},{default:a(()=>[o(m,{onClick:ve},{default:a(()=>[...e[17]||(e[17]=[v("å•†åŸé¦–é¡µ",-1)])]),_:1}),o(m,{onClick:me},{default:a(()=>[...e[18]||(e[18]=[v("è´­ç‰©è½¦",-1)])]),_:1}),o(m,null,{default:a(()=>[...e[19]||(e[19]=[v("ç¡®è®¤è®¢å•",-1)])]),_:1})]),_:1})]),U.value?(i(),d("div",gt,[o(fe,{rows:10,animated:""})])):(i(),d("div",Ue,[s("div",Me,[s("div",$e,[e[22]||(e[22]=s("h3",null,"æ”¶è´§ä¿¡æ¯",-1)),o(h,{type:"text",onClick:e[0]||(e[0]=t=>y.value=!0)},{default:a(()=>[...e[21]||(e[21]=[v("ç®¡ç†åœ°å€",-1)])]),_:1})]),_.value.length>0?(i(),d("div",Oe,[(i(!0),d(q,null,N(_.value,t=>(i(),d("div",{key:t.id,class:B(["address-item",{active:p.value===t.id}]),onClick:D=>p.value=t.id},[s("div",Pe,[s("div",Be,[s("span",Fe,n(t.receiverName),1),s("span",ze,n(t.phone),1),t.isDefault?(i(),Ce(pe,{key:0,size:"small",type:"success"},{default:a(()=>[...e[23]||(e[23]=[v("é»˜è®¤",-1)])]),_:1})):P("",!0)]),s("div",Re,n(t.province)+n(t.city)+n(t.district)+n(t.detail),1)]),s("div",Te,[o(O,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=D=>p.value=D),label:t.id,size:"large"},null,8,["modelValue","label"])])],10,Ae))),128))])):(i(),d("div",je,[o(G,{description:"æš‚æ— æ”¶è´§åœ°å€","image-size":100},{default:a(()=>[o(h,{type:"primary",onClick:e[2]||(e[2]=t=>y.value=!0)},{default:a(()=>[...e[24]||(e[24]=[v("æ·»åŠ åœ°å€",-1)])]),_:1})]),_:1})]))]),s("div",Ee,[e[25]||(e[25]=s("div",{class:"section-header"},[s("h3",null,"å•†å“ä¿¡æ¯")],-1)),s("div",Je,[(i(!0),d(q,null,N(b.value,t=>(i(),d("div",{key:t.id,class:"order-item"},[s("div",Le,[s("img",{src:t.image,alt:t.name},null,8,Ge)]),s("div",He,[s("div",Ke,n(t.name),1),s("div",Qe,n(ce(t.specs)),1)]),s("div",We,"Â¥"+n(t.price),1),s("div",Xe,"x"+n(t.quantity),1),s("div",Ye,"Â¥"+n(t.subtotal),1)]))),128))])]),s("div",Ze,[e[26]||(e[26]=s("div",{class:"section-header"},[s("h3",null,"é…é€æ–¹å¼")],-1)),s("div",et,[o(H,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t)},{default:a(()=>[(i(!0),d(q,null,N(M.value,t=>(i(),d("div",{key:t.id,class:B(["delivery-option",{active:k.value===t.id}])},[o(O,{label:t.id},{default:a(()=>[v(n(t.name),1)]),_:2},1032,["label"]),s("div",tt,[v(n(t.description)+" ",1),t.fee>0?(i(),d("span",st,"+Â¥"+n(t.fee),1)):P("",!0)])],2))),128))]),_:1},8,["modelValue"])])]),s("div",lt,[e[27]||(e[27]=s("div",{class:"section-header"},[s("h3",null,"æ”¯ä»˜æ–¹å¼")],-1)),s("div",ot,[o(H,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=t=>V.value=t)},{default:a(()=>[(i(!0),d(q,null,N(z.value,t=>(i(),d("div",{key:t.id,class:B(["payment-option",{active:V.value===t.id}])},[o(O,{label:t.id},{default:a(()=>[v(n(t.name),1)]),_:2},1032,["label"]),s("div",at,n(t.icon),1)],2))),128))]),_:1},8,["modelValue"])])]),s("div",nt,[e[28]||(e[28]=s("div",{class:"section-header"},[s("h3",null,"ä¼˜æƒ åˆ¸")],-1)),s("div",{class:"coupon-selector",onClick:e[5]||(e[5]=t=>I.value=!0)},[f.value?(i(),d("span",it,n(f.value.name)+" (Â¥"+n(f.value.value)+"æŠ˜æ‰£) ",1)):(i(),d("span",dt,"è¯·é€‰æ‹©ä¼˜æƒ åˆ¸")),o(_e,{class:"el-icon--right"},{default:a(()=>[o(Ie(xe))]),_:1})])]),s("div",ut,[e[29]||(e[29]=s("div",{class:"section-header"},[s("h3",null,"è®¢å•å¤‡æ³¨")],-1)),o(A,{modelValue:T.value,"onUpdate:modelValue":e[6]||(e[6]=t=>T.value=t),placeholder:"é€‰å¡«ï¼Œè¯·è¾“å…¥è®¢å•å¤‡æ³¨ä¿¡æ¯",type:"textarea",rows:2,onInput:l.sanitizeInput},null,8,["modelValue","onInput"])]),s("div",rt,[s("div",ct,[e[30]||(e[30]=s("span",null,"å•†å“æ€»ä»·",-1)),s("span",null,"Â¥"+n($.value),1)]),s("div",vt,[e[31]||(e[31]=s("span",null,"è¿è´¹",-1)),s("span",null,"Â¥"+n(J.value),1)]),j.value>0?(i(),d("div",mt,[e[32]||(e[32]=s("span",{class:"text-success"},"ä¼˜æƒ åˆ¸æŠ˜æ‰£",-1)),s("span",pt,"-Â¥"+n(j.value),1)])):P("",!0),s("div",_t,[e[33]||(e[33]=s("span",null,"å®ä»˜æ¬¾",-1)),s("span",ft,"Â¥"+n(L.value),1)])])]))]),U.value?P("",!0):(i(),d("div",kt,[s("div",yt,[s("div",ht,[e[34]||(e[34]=v(" å®ä»˜æ¬¾ï¼š",-1)),s("span",bt,"Â¥"+n(L.value),1)]),s("div",Vt,[o(h,{type:"primary",onClick:re,loading:F.value},{default:a(()=>[...e[35]||(e[35]=[v(" æäº¤è®¢å• ",-1)])]),_:1},8,["loading"])])])])),o(K,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=t=>y.value=t),title:"ç®¡ç†æ”¶è´§åœ°å€",width:"600px","close-on-click-modal":!1},{footer:a(()=>[o(h,{onClick:e[12]||(e[12]=t=>y.value=!1)},{default:a(()=>[...e[37]||(e[37]=[v("å–æ¶ˆ",-1)])]),_:1}),o(h,{type:"primary",onClick:ie},{default:a(()=>[...e[38]||(e[38]=[v("ä¿å­˜",-1)])]),_:1})]),default:a(()=>[s("div",Ct,[s("div",It,[o(ye,{model:u.value,rules:W,ref:"addressFormRef"},{default:a(()=>[o(x,{label:"æ”¶è´§äºº",prop:"receiverName"},{default:a(()=>[o(A,{modelValue:u.value.receiverName,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.receiverName=t),placeholder:"è¯·è¾“å…¥æ”¶è´§äººå§“å"},null,8,["modelValue"])]),_:1}),o(x,{label:"æ‰‹æœºå·ç ",prop:"phone"},{default:a(()=>[o(A,{modelValue:u.value.phone,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.phone=t),placeholder:"è¯·è¾“å…¥æ‰‹æœºå·ç "},null,8,["modelValue"])]),_:1}),o(x,{label:"æ‰€åœ¨åœ°åŒº",prop:"region"},{default:a(()=>[o(ge,{modelValue:u.value.region,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.region=t),options:X.value,placeholder:"è¯·é€‰æ‹©çœ/å¸‚/åŒº",filterable:"",onChange:ne},null,8,["modelValue","options"])]),_:1}),o(x,{label:"è¯¦ç»†åœ°å€",prop:"detail"},{default:a(()=>[o(A,{modelValue:u.value.detail,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.detail=t),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥è¯¦ç»†åœ°å€"},null,8,["modelValue"])]),_:1}),o(x,null,{default:a(()=>[o(ke,{modelValue:u.value.isDefault,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.isDefault=t)},{default:a(()=>[...e[36]||(e[36]=[v("è®¾ä¸ºé»˜è®¤åœ°å€",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"]),o(K,{modelValue:I.value,"onUpdate:modelValue":e[16]||(e[16]=t=>I.value=t),title:"é€‰æ‹©ä¼˜æƒ åˆ¸",width:"600px","close-on-click-modal":!1},{footer:a(()=>[o(h,{onClick:e[15]||(e[15]=t=>I.value=!1)},{default:a(()=>[...e[39]||(e[39]=[v("å…³é—­",-1)])]),_:1})]),default:a(()=>[s("div",xt,[R.value.length>0?(i(),d("div",Dt,[(i(!0),d(q,null,N(R.value,t=>(i(),d("div",{key:t.id,class:B(["coupon-item",{active:C.value===t.id}]),onClick:D=>ue(t)},[s("div",qt,"Â¥"+n(t.value),1),s("div",Nt,[s("div",St,n(t.name),1),s("div",Ut,"æ»¡"+n(t.minSpend)+"å¯ç”¨",1),s("div",Mt,"æœ‰æ•ˆæœŸè‡³ï¼š"+n(t.expireDate),1)]),o(O,{modelValue:C.value,"onUpdate:modelValue":e[14]||(e[14]=D=>C.value=D),label:t.id,size:"large"},null,8,["modelValue","label"])],10,wt))),128))])):(i(),d("div",$t,[o(G,{description:"æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸"})]))])]),_:1},8,["modelValue"])])}}},Ft=we(Ot,[["__scopeId","data-v-7444f8c5"]]);export{Ft as default};
