import{r as v,a as N,o as E,c as k,b as u,d as s,e as L,w as t,f as d,u as P,g as w,h as c,E as g,i as U,j as B}from"./index-zq5Uwr5D.js";import{a as T}from"./index-DgIvehK0.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"login-container"},J={class:"login-form-wrapper"},O={class:"button-container"},z={key:0,class:"error-message"},A={__name:"Login",setup(D){const f=v(null),l=N({username:"",password:"",rememberMe:!1}),S={username:[{required:!0,message:"请输入账号信息",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},a=v(!1),p=v(""),b=P();E(()=>{R()});const y=async()=>{f.value.validate(async m=>{if(m){const e=U.service({lock:!0,text:"登录中...",background:"rgba(0, 0, 0, 0.7)"});p.value="";try{const o=await T.user.login(l);if(o&&o.code===1){const r=B();console.log("登录响应数据:",o.data),console.log("token是否存在于响应中:",o.data.token?"是":"否"),r.login(o.data),localStorage.setItem("userInfo",JSON.stringify(o.data)),console.log("userInfo已存储到localStorage"),localStorage.setItem("token",o.data.token),console.log("token已单独存储到localStorage:",o.data.token);const _=o.data.role===0?"admin":"user";localStorage.setItem("role",_),localStorage.setItem("userId",o.data.user?.id||"");const n=localStorage.getItem("token");console.log("验证token存储结果:",n?"成功":"失败"),l.rememberMe?M():C(),g.success("登录成功"),r.role==="admin"?b.push("/admin/home"):b.push("/user/home")}else g.error("登录失败："+(o?.msg||o?.message||"用户名或密码错误"))}catch(o){console.error("登录请求失败:",o),o.response&&o.response.data?g.error("登录失败："+(o.response.data.msg||o.response.data.message||"用户名或密码错误")):g.error("登录失败：用户名或密码错误")}finally{setTimeout(()=>{e.close()},300),a.value=!1}}})},I=()=>{f.value.resetFields(),p.value=""},V=()=>{g("密码重置功能开发中")},x=()=>{b.push("/register")},M=()=>{localStorage.setItem("remembered_username",l.username)},R=()=>{const m=localStorage.getItem("remembered_username");m&&(l.username=m,l.rememberMe=!0)},C=()=>{localStorage.removeItem("remembered_username")};return(m,e)=>{const o=d("el-input"),r=d("el-form-item"),_=d("el-checkbox"),n=d("el-button"),h=d("el-form"),F=d("el-alert");return w(),k("div",j,[u("div",J,[e[9]||(e[9]=u("div",{class:"login-header"},[u("h2",null,"老年人健康服务平台")],-1)),s(h,{model:l,rules:S,ref_key:"loginFormRef",ref:f,class:"login-form"},{default:t(()=>[s(r,{label:"账号",prop:"username",class:"login-form-item"},{default:t(()=>[s(o,{modelValue:l.username,"onUpdate:modelValue":e[0]||(e[0]=i=>l.username=i),placeholder:"请输入账号",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(r,{label:"密码",prop:"password",class:"login-form-item"},{default:t(()=>[s(o,{modelValue:l.password,"onUpdate:modelValue":e[1]||(e[1]=i=>l.password=i),type:"password",placeholder:"请输入密码","show-password":"",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(r,{class:"login-form-item remember-password text-center"},{default:t(()=>[s(_,{modelValue:l.rememberMe,"onUpdate:modelValue":e[2]||(e[2]=i=>l.rememberMe=i)},{default:t(()=>[...e[3]||(e[3]=[c("记住密码",-1)])]),_:1},8,["modelValue"]),e[5]||(e[5]=u("br",null,null,-1)),s(n,{type:"text",onClick:V,disabled:a.value},{default:t(()=>[...e[4]||(e[4]=[c("忘记密码？",-1)])]),_:1},8,["disabled"])]),_:1}),s(r,{class:"login-form-item login-button-group"},{default:t(()=>[u("div",O,[s(n,{type:"primary",onClick:y,loading:a.value,class:"login-btn"},{default:t(()=>[...e[6]||(e[6]=[c(" 登录 ",-1)])]),_:1},8,["loading"]),s(n,{onClick:I,disabled:a.value,class:"reset-btn"},{default:t(()=>[...e[7]||(e[7]=[c(" 重置 ",-1)])]),_:1},8,["disabled"])])]),_:1}),s(r,{class:"login-form-item"},{default:t(()=>[s(n,{type:"text",onClick:x,disabled:a.value},{default:t(()=>[...e[8]||(e[8]=[c(" 还没有账号？立即注册 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),p.value?(w(),k("div",z,[s(F,{title:p.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):L("",!0)])])}}},Q=q(A,[["__scopeId","data-v-52245ad2"]]);export{Q as default};
