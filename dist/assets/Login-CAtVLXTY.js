import{r as v,a as N,o as E,c as k,b as u,d as s,e as L,w as r,f as d,u as P,g as w,h as c,E as g,i as U,j as B}from"./index-B9RLcm7_.js";import{a as T}from"./index-SBUbweXm.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"login-container"},J={class:"login-form-wrapper"},O={class:"button-container"},z={key:0,class:"error-message"},A={__name:"Login",setup(D){const f=v(null),l=N({username:"",password:"",rememberMe:!1}),S={username:[{required:!0,message:"请输入账号信息",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},a=v(!1),p=v(""),b=P();E(()=>{M()});const x=async()=>{f.value.validate(async m=>{if(m){const o=U.service({lock:!0,text:"登录中...",background:"rgba(0, 0, 0, 0.7)"});p.value="";try{const e=await T.user.login(l);if(e&&e.code===1){const t=B();console.log("登录响应数据:",e.data),console.log("token是否存在于响应中:",e.data.token?"是":"否"),t.login(e.data),localStorage.setItem("userInfo",JSON.stringify(e.data)),console.log("userInfo已存储到localStorage"),localStorage.setItem("token",e.data.token),console.log("token已单独存储到localStorage:",e.data.token);const _=e.data.role===0?"admin":"user";localStorage.setItem("role",_),localStorage.setItem("userId",e.data.user?.id||"");const n=localStorage.getItem("token");console.log("验证token存储结果:",n?"成功":"失败"),l.rememberMe?h():R(),g.success("登录成功"),t.role==="admin"?b.push("/admin/home"):b.push("/user/home")}else g.error("登录失败："+(e?.msg||e?.message||"用户名或密码错误"))}catch(e){console.error("登录请求失败:",e),e.response&&e.response.data?g.error("登录失败："+(e.response.data.msg||e.response.data.message||"用户名或密码错误")):g.error("登录失败：用户名或密码错误")}finally{setTimeout(()=>{o.close()},300),a.value=!1}}})},y=()=>{f.value.resetFields(),p.value=""},I=()=>{g("密码重置功能开发中")},V=()=>{b.push("/register")},h=()=>{localStorage.setItem("remembered_username",l.username)},M=()=>{const m=localStorage.getItem("remembered_username");m&&(l.username=m,l.rememberMe=!0)},R=()=>{localStorage.removeItem("remembered_username")};return(m,o)=>{const e=d("el-input"),t=d("el-form-item"),_=d("el-checkbox"),n=d("el-button"),C=d("el-form"),F=d("el-alert");return w(),k("div",j,[u("div",J,[o[8]||(o[8]=u("div",{class:"login-header"},[u("h2",null,"老年人健康服务平台"),u("p",null,"系统登录")],-1)),s(C,{model:l,rules:S,ref_key:"loginFormRef",ref:f,class:"login-form"},{default:r(()=>[s(t,{label:"账号",prop:"username",class:"login-form-item"},{default:r(()=>[s(e,{modelValue:l.username,"onUpdate:modelValue":o[0]||(o[0]=i=>l.username=i),placeholder:"请输入账号","prefix-icon":"el-icon-user",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(t,{label:"密码",prop:"password",class:"login-form-item"},{default:r(()=>[s(e,{modelValue:l.password,"onUpdate:modelValue":o[1]||(o[1]=i=>l.password=i),type:"password",placeholder:"请输入密码","prefix-icon":"el-icon-lock","show-password":"",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),s(t,{class:"login-form-item remember-password text-center"},{default:r(()=>[s(_,{modelValue:l.rememberMe,"onUpdate:modelValue":o[2]||(o[2]=i=>l.rememberMe=i)},{default:r(()=>[...o[3]||(o[3]=[c("记住密码",-1)])]),_:1},8,["modelValue"]),s(n,{type:"text",onClick:I,disabled:a.value},{default:r(()=>[...o[4]||(o[4]=[c("忘记密码？",-1)])]),_:1},8,["disabled"])]),_:1}),s(t,{class:"login-form-item login-button-group"},{default:r(()=>[u("div",O,[s(n,{type:"primary",onClick:x,loading:a.value,class:"login-btn"},{default:r(()=>[...o[5]||(o[5]=[c(" 登录 ",-1)])]),_:1},8,["loading"]),s(n,{onClick:y,disabled:a.value,class:"reset-btn"},{default:r(()=>[...o[6]||(o[6]=[c(" 重置 ",-1)])]),_:1},8,["disabled"])])]),_:1}),s(t,{class:"login-form-item"},{default:r(()=>[s(n,{type:"text",onClick:V,disabled:a.value},{default:r(()=>[...o[7]||(o[7]=[c(" 还没有账号？立即注册 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),p.value?(w(),k("div",z,[s(F,{title:p.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):L("",!0)])])}}},Q=q(A,[["__scopeId","data-v-522c3eb6"]]);export{Q as default};
