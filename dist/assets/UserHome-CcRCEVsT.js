import{r as g,a as ue,k as ce,o as me,i as M,E as m,c as k,b as s,d as t,t as n,w as l,f as p,F as R,D as O,u as pe,g as h,m as y,y as ve,J as P,z as _e,K as ge,h as v,L as fe,M as H,C as he}from"./index-B9RLcm7_.js";import{a as I}from"./index-SBUbweXm.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"user-home"},ke={class:"welcome-section"},we={class:"quick-access-section"},Se={class:"quick-card-content"},De={class:"quick-card-icon health-icon"},Ie={class:"quick-card-content"},xe={class:"quick-card-icon mall-icon"},qe={class:"quick-card-content"},Ve={class:"quick-card-icon service-icon"},Ce={class:"quick-card-content"},Re={class:"quick-card-icon record-icon"},Ne={class:"main-content"},Te={class:"left-panel"},Ue={class:"card-header"},$e={class:"card-actions"},Me={class:"basic-info-content"},Oe={class:"info-item"},Pe={class:"info-value"},He={class:"info-item"},ze={class:"info-value"},Be={class:"info-item"},Fe={class:"info-value"},Ee={class:"info-item"},Le={class:"info-value"},Ae={class:"info-item"},Je={class:"info-value"},je={class:"info-item"},Ye={class:"info-value"},Ke={class:"health-section"},Ge={class:"health-indicators"},Qe={class:"card-header"},We={class:"indicator-content"},Xe={class:"latest-value"},Ze={class:"measure-time"},es={class:"card-header"},ss={class:"indicator-content"},ts={class:"latest-value"},as={class:"measure-time"},ls={class:"card-header"},os={class:"indicator-content"},is={class:"latest-value"},ns={class:"measure-time"},ds={class:"right-panel"},rs={class:"mall-section"},us={class:"mall-products"},cs=["onClick"],ms={class:"product-image"},ps=["src","alt"],vs={class:"product-info"},_s={class:"product-name"},gs={class:"product-price"},fs={class:"view-more"},hs={class:"service-section"},ys={class:"service-content"},bs={key:1,class:"service-list"},ks={class:"service-info"},ws={class:"service-type"},Ss={class:"service-date"},Ds={class:"service-person"},Is={class:"service-status"},xs={class:"view-all"},qs={class:"user-detail-content"},Vs={class:"detail-section"},Cs={class:"detail-grid"},Rs={class:"detail-item"},Ns={class:"detail-value"},Ts={class:"detail-item"},Us={class:"detail-value"},$s={class:"detail-item"},Ms={class:"detail-value"},Os={class:"detail-item"},Ps={class:"detail-value"},Hs={class:"detail-item"},zs={class:"detail-value"},Bs={class:"detail-item"},Fs={class:"detail-value"},Es={class:"detail-section"},Ls={class:"detail-grid"},As={class:"detail-item"},Js={class:"detail-value"},js={class:"detail-item"},Ys={class:"detail-value"},Ks={class:"detail-section"},Gs={class:"detail-grid"},Qs={class:"detail-item"},Ws={class:"detail-value"},Xs={class:"detail-item"},Zs={class:"detail-value"},et={class:"dialog-footer"},st={class:"dialog-footer"},tt={__name:"UserHome",setup(at){const x=pe(),o=g(null),_=g(null),b=g([]);g(!1);const w=g(!1),S=g(!1),z=g(!1),N=g(null),d=ue({name:"",age:0,gender:"",phone:"",email:""}),B={name:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度应在2-20个字符之间",trigger:"blur"}],age:[{required:!0,message:"请输入年龄",trigger:"blur"},{type:"number",min:0,max:150,message:"年龄应在0-150之间",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},F=g([{id:1,name:"智能血压计",price:299,image:"/images/products/blood-pressure.jpg"},{id:2,name:"血糖仪套装",price:199,image:"/images/products/blood-sugar.jpg"},{id:3,name:"老年人保健枕",price:129,image:"/images/products/pillow.jpg"}]),E=ce(()=>b.value.slice(0,3));me(()=>{L()});const L=async()=>{const u=M.service({lock:!0,text:"加载中...",background:"rgba(0, 0, 0, 0.7)"});try{const e=localStorage.getItem("userInfo");if(e)try{const a=JSON.parse(e);o.value={...a,age:a.age||65,gender:a.gender||"男",healthRecordNumber:a.healthRecordNumber||"HR20240001",phone:a.phone||a.username,email:a.email||""}}catch(a){console.error("解析localStorage用户信息失败",a),m.warning("用户信息解析失败，使用默认设置")}try{const a=await I.user.getUserBasicInfo(o.value?.id);if(a&&a.code===1&&a.data){const r=a.data;o.value={...o.value,...r},localStorage.setItem("userInfo",JSON.stringify(o.value)),localStorage.setItem("userId",o.value.id)}}catch(a){console.warn("获取最新用户信息失败",a)}try{const a=await I.user.getHealthData();a&&a.code===200&&a.data||a&&a.code===1&&a.data?_.value=a.data:(console.warn("获取健康数据返回格式不符合预期:",a),_.value={bloodPressure:{latest:{systolic:120,diastolic:80,date:new Date().toISOString().split("T")[0]}},bloodSugar:{latest:{value:5.8,date:new Date().toISOString().split("T")[0]}},heartRate:{latest:{value:72,date:new Date().toISOString().split("T")[0]}}})}catch(a){console.warn("获取健康数据失败，使用默认数据",a),_.value={bloodPressure:{latest:{systolic:120,diastolic:80,date:new Date().toISOString().split("T")[0]}},bloodSugar:{latest:{value:5.8,date:new Date().toISOString().split("T")[0]}},heartRate:{latest:{value:72,date:new Date().toISOString().split("T")[0]}}}}try{const a=await I.user.getServiceRecords();a&&a.code===200&&a.data||a&&a.code===1&&a.data?b.value=a.data:(console.warn("获取服务记录返回格式不符合预期:",a),b.value=[{id:1,type:"健康体检",date:"2024-10-15",employeeName:"张医生",employeeDepartment:"体检科",status:1},{id:2,type:"上门问诊",date:"2024-10-10",employeeName:"李护士",employeeDepartment:"社区医疗",status:1},{id:3,type:"慢病管理",date:"2024-10-05",employeeName:"王医生",employeeDepartment:"内科",status:1}])}catch(a){console.warn("获取服务记录失败，使用默认数据",a),b.value=[{id:1,type:"健康体检",date:"2024-10-15",employeeName:"张医生",employeeDepartment:"体检科",status:1},{id:2,type:"上门问诊",date:"2024-10-10",employeeName:"李护士",employeeDepartment:"社区医疗",status:1},{id:3,type:"慢病管理",date:"2024-10-05",employeeName:"王医生",employeeDepartment:"内科",status:1}]}}finally{setTimeout(()=>{u.close()},300)}},A=()=>{x.push("/user/ai-consult")},T=()=>{try{x.push("/user/mall")}catch{m.info("商城功能正在开发中")}},J=()=>{m.info("服务预约功能正在开发中")},j=()=>{m.info("健康档案功能正在开发中")},Y=u=>{try{x.push(`/user/mall/product/${u}`)}catch{m.info("商品详情页面正在开发中")}},K=async u=>{try{m.success("已成功添加到购物车")}catch{m.error("添加失败，请重试")}},G=u=>{const e=u.getFullYear(),a=String(u.getMonth()+1).padStart(2,"0"),r=String(u.getDate()).padStart(2,"0");return`${e}年${a}月${r}日`},Q=u=>{switch(u){case"已完成":return"success";case"进行中":return"primary";case"待处理":return"warning";default:return"info"}},W=()=>{w.value=!0},U=()=>{d.name=o.value?.name||"",d.age=o.value?.age||0,d.gender=o.value?.gender||"",d.phone=o.value?.phone||"",d.email=o.value?.email||"",S.value=!0},X=async()=>{await N.value.validate(async u=>{if(u){const e=M.service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"});try{const a={id:o.value?.id,name:d.name,age:d.age,gender:d.gender,phone:d.phone,email:d.email},r=await I.user.updateUser(a);if(r&&r.code===1)o.value={...o.value,...a},localStorage.setItem("userInfo",JSON.stringify(o.value)),localStorage.setItem("userId",o.value.id),m.success("个人信息更新成功"),S.value=!1;else{const f=r&&r.msg?r.msg:"未知错误";m.error("更新失败："+f)}}catch(a){console.error("更新用户信息失败",a),m.error("更新失败，请检查网络连接")}finally{setTimeout(()=>{e.close()},300)}}})},Z=u=>{if(!u)return"-";const e=new Date(u);if(isNaN(e.getTime()))return"-";const a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0"),q=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0");return`${a}-${r}-${f} ${q}:${c}`},ee=()=>{m("查看血压历史数据功能开发中")},se=()=>{m("查看血糖历史数据功能开发中")},te=()=>{m("查看心率历史数据功能开发中")},ae=()=>{m("查看全部服务记录功能开发中")};return(u,e)=>{const a=p("el-icon"),r=p("el-card"),f=p("el-col"),q=p("el-row"),c=p("el-button"),le=p("el-empty"),oe=p("el-tag"),$=p("el-dialog"),V=p("el-input"),D=p("el-form-item"),ie=p("el-input-number"),C=p("el-option"),ne=p("el-select"),de=p("el-form");return h(),k(R,null,[s("div",be,[s("div",ke,[s("h1",null,"您好，"+n(o.value?.name||"用户")+"！",1),s("p",null,"今天是"+n(G(new Date))+"，祝您健康快乐！",1)]),s("div",we,[t(q,{gutter:20},{default:l(()=>[t(f,{xs:12,sm:8,md:6},{default:l(()=>[t(r,{class:"quick-card",onClick:A,shadow:"hover","body-style":"padding: 20px; cursor: pointer;"},{default:l(()=>[s("div",Se,[s("div",De,[t(a,null,{default:l(()=>[t(y(ve))]),_:1})]),e[10]||(e[10]=s("h3",{class:"quick-card-title"},"健康咨询",-1)),e[11]||(e[11]=s("p",{class:"quick-card-desc"},"AI助手专业解答健康疑问",-1))])]),_:1})]),_:1}),t(f,{xs:12,sm:8,md:6},{default:l(()=>[t(r,{class:"quick-card",onClick:T,shadow:"hover","body-style":"padding: 20px; cursor: pointer;"},{default:l(()=>[s("div",Ie,[s("div",xe,[t(a,null,{default:l(()=>[t(y(P))]),_:1})]),e[12]||(e[12]=s("h3",{class:"quick-card-title"},"健康商城",-1)),e[13]||(e[13]=s("p",{class:"quick-card-desc"},"精选健康产品一键购买",-1))])]),_:1})]),_:1}),t(f,{xs:12,sm:8,md:6},{default:l(()=>[t(r,{class:"quick-card",onClick:J,shadow:"hover","body-style":"padding: 20px; cursor: pointer;"},{default:l(()=>[s("div",qe,[s("div",Ve,[t(a,null,{default:l(()=>[t(y(_e))]),_:1})]),e[14]||(e[14]=s("h3",{class:"quick-card-title"},"服务预约",-1)),e[15]||(e[15]=s("p",{class:"quick-card-desc"},"便捷预约各类健康服务",-1))])]),_:1})]),_:1}),t(f,{xs:12,sm:8,md:6},{default:l(()=>[t(r,{class:"quick-card",onClick:j,shadow:"hover","body-style":"padding: 20px; cursor: pointer;"},{default:l(()=>[s("div",Ce,[s("div",Re,[t(a,null,{default:l(()=>[t(y(ge))]),_:1})]),e[16]||(e[16]=s("h3",{class:"quick-card-title"},"健康档案",-1)),e[17]||(e[17]=s("p",{class:"quick-card-desc"},"完整记录您的健康数据",-1))])]),_:1})]),_:1})]),_:1})]),s("div",Ne,[s("div",Te,[t(r,{class:"info-card",shadow:"hover"},{header:l(()=>[s("div",Ue,[e[20]||(e[20]=s("span",null,"个人信息",-1)),s("div",$e,[t(c,{type:"text",size:"small",onClick:W},{default:l(()=>[...e[18]||(e[18]=[v("详情",-1)])]),_:1}),t(c,{type:"primary",size:"small",onClick:U},{default:l(()=>[...e[19]||(e[19]=[v("编辑",-1)])]),_:1})])])]),default:l(()=>[s("div",Me,[s("div",Oe,[e[21]||(e[21]=s("span",{class:"info-label"},"姓名",-1)),s("span",Pe,n(o.value?.name||"-"),1)]),s("div",He,[e[22]||(e[22]=s("span",{class:"info-label"},"年龄",-1)),s("span",ze,n(o.value?.age||"-")+"岁",1)]),s("div",Be,[e[23]||(e[23]=s("span",{class:"info-label"},"性别",-1)),s("span",Fe,n(o.value?.gender||"-"),1)]),s("div",Ee,[e[24]||(e[24]=s("span",{class:"info-label"},"健康档案号",-1)),s("span",Le,n(o.value?.healthRecordNumber||"-"),1)]),s("div",Ae,[e[25]||(e[25]=s("span",{class:"info-label"},"联系电话",-1)),s("span",Je,n(o.value?.phone||"-"),1)]),s("div",je,[e[26]||(e[26]=s("span",{class:"info-label"},"邮箱",-1)),s("span",Ye,n(o.value?.email||"-"),1)])])]),_:1}),s("div",Ke,[e[36]||(e[36]=s("h3",{class:"section-title"},"健康数据",-1)),s("div",Ge,[t(r,{class:"indicator-card",shadow:"hover"},{header:l(()=>[s("div",Qe,[e[28]||(e[28]=s("span",null,"血压",-1)),t(c,{type:"text",size:"small",onClick:ee},{default:l(()=>[...e[27]||(e[27]=[v("详情",-1)])]),_:1})])]),default:l(()=>[s("div",We,[s("div",Xe,n(_.value?.bloodPressure?.latest?.systolic||"-")+"/"+n(_.value?.bloodPressure?.latest?.diastolic||"-"),1),e[29]||(e[29]=s("div",{class:"unit"},"mmHg",-1)),s("div",Ze,"测量时间："+n(_.value?.bloodPressure?.latest?.date||"-"),1)])]),_:1}),t(r,{class:"indicator-card",shadow:"hover"},{header:l(()=>[s("div",es,[e[31]||(e[31]=s("span",null,"血糖",-1)),t(c,{type:"text",size:"small",onClick:se},{default:l(()=>[...e[30]||(e[30]=[v("详情",-1)])]),_:1})])]),default:l(()=>[s("div",ss,[s("div",ts,n(_.value?.bloodSugar?.latest?.value||"-"),1),e[32]||(e[32]=s("div",{class:"unit"},"mmol/L",-1)),s("div",as,"测量时间："+n(_.value?.bloodSugar?.latest?.date||"-"),1)])]),_:1}),t(r,{class:"indicator-card",shadow:"hover"},{header:l(()=>[s("div",ls,[e[34]||(e[34]=s("span",null,"心率",-1)),t(c,{type:"text",size:"small",onClick:te},{default:l(()=>[...e[33]||(e[33]=[v("详情",-1)])]),_:1})])]),default:l(()=>[s("div",os,[s("div",is,n(_.value?.heartRate?.latest?.value||"-"),1),e[35]||(e[35]=s("div",{class:"unit"},"bpm",-1)),s("div",ns,"测量时间："+n(_.value?.heartRate?.latest?.date||"-"),1)])]),_:1})])])]),s("div",ds,[s("div",rs,[e[39]||(e[39]=s("h3",{class:"section-title"},"健康商城推荐",-1)),s("div",us,[(h(!0),k(R,null,O(F.value,i=>(h(),k("div",{key:i.id,class:"product-item",onClick:re=>Y(i.id)},[s("div",ms,[s("img",{src:i.image,alt:i.name},null,8,ps)]),s("div",vs,[s("div",_s,n(i.name),1),s("div",gs,"¥"+n(i.price),1)]),t(c,{type:"primary",size:"small",onClick:fe(re=>K(i.id),["stop"]),class:"add-cart-btn"},{default:l(()=>[t(a,null,{default:l(()=>[t(y(P))]),_:1}),e[37]||(e[37]=v(" 加入购物车 ",-1))]),_:1},8,["onClick"])],8,cs))),128)),s("div",fs,[t(c,{type:"text",onClick:T},{default:l(()=>[e[38]||(e[38]=v("查看更多 ",-1)),t(a,null,{default:l(()=>[t(y(H))]),_:1})]),_:1})])])]),s("div",hs,[e[41]||(e[41]=s("h3",{class:"section-title"},"最近服务",-1)),t(r,{class:"service-card",shadow:"hover"},{default:l(()=>[s("div",ys,[!b.value||b.value.length===0?(h(),he(le,{key:0,description:"暂无服务记录"})):(h(),k("div",bs,[(h(!0),k(R,null,O(E.value,i=>(h(),k("div",{key:i.id,class:"service-item"},[s("div",ks,[s("div",ws,n(i.type),1),s("div",Ss,"服务时间："+n(i.date),1),s("div",Ds,"服务人员："+n(i.servicePerson),1)]),s("div",Is,[t(oe,{type:Q(i.status)},{default:l(()=>[v(n(i.status),1)]),_:2},1032,["type"])])]))),128))])),s("div",xs,[t(c,{type:"text",onClick:ae},{default:l(()=>[e[40]||(e[40]=v("查看全部 ",-1)),t(a,null,{default:l(()=>[t(y(H))]),_:1})]),_:1})])])]),_:1})])])])]),t($,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=i=>w.value=i),title:"个人信息详情",width:"600px","close-on-click-modal":!1},{footer:l(()=>[s("span",et,[t(c,{onClick:e[0]||(e[0]=i=>w.value=!1)},{default:l(()=>[...e[55]||(e[55]=[v("关闭",-1)])]),_:1}),t(c,{type:"primary",onClick:e[1]||(e[1]=i=>{w.value=!1})},{default:l(()=>[...e[56]||(e[56]=[v("编辑信息",-1)])]),_:1})])]),default:l(()=>[s("div",qs,[s("div",Vs,[e[48]||(e[48]=s("h4",{class:"section-subtitle"},"基本信息",-1)),s("div",Cs,[s("div",Rs,[e[42]||(e[42]=s("span",{class:"detail-label"},"用户名",-1)),s("span",Ns,n(o.value?.username||"-"),1)]),s("div",Ts,[e[43]||(e[43]=s("span",{class:"detail-label"},"姓名",-1)),s("span",Us,n(o.value?.name||"-"),1)]),s("div",$s,[e[44]||(e[44]=s("span",{class:"detail-label"},"年龄",-1)),s("span",Ms,n(o.value?.age||"-")+"岁",1)]),s("div",Os,[e[45]||(e[45]=s("span",{class:"detail-label"},"性别",-1)),s("span",Ps,n(o.value?.gender||"-"),1)]),s("div",Hs,[e[46]||(e[46]=s("span",{class:"detail-label"},"健康档案号",-1)),s("span",zs,n(o.value?.healthRecordNumber||"-"),1)]),s("div",Bs,[e[47]||(e[47]=s("span",{class:"detail-label"},"角色",-1)),s("span",Fs,n(o.value?.role===0?"管理员":"普通用户"),1)])])]),s("div",Es,[e[51]||(e[51]=s("h4",{class:"section-subtitle"},"联系方式",-1)),s("div",Ls,[s("div",As,[e[49]||(e[49]=s("span",{class:"detail-label"},"联系电话",-1)),s("span",Js,n(o.value?.phone||"-"),1)]),s("div",js,[e[50]||(e[50]=s("span",{class:"detail-label"},"邮箱",-1)),s("span",Ys,n(o.value?.email||"-"),1)])])]),s("div",Ks,[e[54]||(e[54]=s("h4",{class:"section-subtitle"},"账户信息",-1)),s("div",Gs,[s("div",Qs,[e[52]||(e[52]=s("span",{class:"detail-label"},"创建时间",-1)),s("span",Ws,n(Z(o.value?.createdAt)),1)]),s("div",Xs,[e[53]||(e[53]=s("span",{class:"detail-label"},"状态",-1)),s("span",Zs,n(o.value?.status?"启用":"禁用"),1)])])])])]),_:1},8,["modelValue"]),t($,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=i=>S.value=i),title:"编辑个人信息",width:"600px","close-on-click-modal":!1},{footer:l(()=>[s("span",st,[t(c,{onClick:e[8]||(e[8]=i=>S.value=!1)},{default:l(()=>[...e[57]||(e[57]=[v("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:X,loading:z.value},{default:l(()=>[...e[58]||(e[58]=[v("保存",-1)])]),_:1},8,["loading"])])]),default:l(()=>[t(de,{model:d,rules:B,ref_key:"editFormRef",ref:N,"label-width":"120px"},{default:l(()=>[t(D,{label:"姓名",prop:"name"},{default:l(()=>[t(V,{modelValue:d.name,"onUpdate:modelValue":e[3]||(e[3]=i=>d.name=i),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),t(D,{label:"年龄",prop:"age"},{default:l(()=>[t(ie,{modelValue:d.age,"onUpdate:modelValue":e[4]||(e[4]=i=>d.age=i),min:0,max:150,placeholder:"请输入年龄"},null,8,["modelValue"])]),_:1}),t(D,{label:"性别",prop:"gender"},{default:l(()=>[t(ne,{modelValue:d.gender,"onUpdate:modelValue":e[5]||(e[5]=i=>d.gender=i),placeholder:"请选择性别"},{default:l(()=>[t(C,{label:"男",value:"男"}),t(C,{label:"女",value:"女"}),t(C,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),t(D,{label:"联系电话",prop:"phone"},{default:l(()=>[t(V,{modelValue:d.phone,"onUpdate:modelValue":e[6]||(e[6]=i=>d.phone=i),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),t(D,{label:"邮箱",prop:"email"},{default:l(()=>[t(V,{modelValue:d.email,"onUpdate:modelValue":e[7]||(e[7]=i=>d.email=i),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}},nt=ye(tt,[["__scopeId","data-v-fa1b1e18"]]);export{nt as default};
