import{u as V,s as at,c as ot,d as lt,o as nt,l as z}from"./element-DkRX-ly5.js";import{a as it}from"./index-ID-G45V4.js";import{i as P}from"./echarts-CSf_FMkx.js";import{_ as rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{l as ct,r as y,j as q,h as dt,n as A,X as ut,z as _,B as e,P as m,R as a,J as o,al as b,A as c,u as h,I,L as U,Q as vt,a5 as pt,O as F}from"./vendor-DdeEpjzh.js";const _t={class:"admin-home"},mt={class:"welcome-section"},ht={class:"stats-section"},ft={class:"stat-content"},yt={class:"stat-icon user-icon"},gt={class:"stat-info"},wt={class:"stat-number"},bt={class:"stat-content"},St={class:"stat-icon service-icon"},xt={class:"stat-info"},At={class:"stat-number"},Ct={class:"stat-content"},kt={class:"stat-icon consult-icon"},Dt={class:"stat-info"},Tt={class:"stat-number"},It={class:"stat-content"},zt={class:"stat-icon today-icon"},Pt={class:"stat-info"},Ut={class:"stat-number"},Et={class:"stat-content"},Lt={class:"stat-icon employee-icon"},Mt={class:"stat-info"},Rt={class:"stat-number"},$t={class:"stat-content"},Bt={class:"stat-icon department-icon"},Ot={class:"stat-info"},Wt={class:"stat-number"},Nt={class:"charts-section"},Vt={class:"chart-container"},qt={key:0,class:"chart-loading"},Ft={key:1},Ht={class:"chart-container"},Yt={key:0,class:"chart-loading"},jt={key:1},Jt={class:"chart-container"},Qt={key:0,class:"chart-loading"},Xt={key:1},Gt={class:"activities-section"},Kt={class:"card-header"},Zt={class:"activities-content"},te={key:1,class:"activities-list"},ee={class:"activity-icon"},se={class:"activity-info"},ae={class:"activity-text"},oe={class:"activity-time"},le={__name:"AdminHome",setup(ne){const H=()=>{const s=[],t=new Date;for(let l=6;l>=0;l--){const n=new Date(t);n.setDate(n.getDate()-l),s.push({date:n.toISOString().split("T")[0],value:Math.floor(Math.random()*100)+20})}return s},E=()=>["行政部","技术部","客服部","市场部","财务部","人力资源部"].map(t=>({name:t,count:Math.floor(Math.random()*30)+5})),i=ct({totalUsers:0,totalServices:0,totalAIConsults:0,todayActiveUsers:0,totalEmployees:0,totalDepartments:0}),g=y(H()),w=y([{name:"健康咨询",value:45},{name:"体检预约",value:25},{name:"报告解读",value:15},{name:"慢病管理",value:15}]),p=y([]),L=y([{type:"login",content:"用户 138****5678 登录系统",timestamp:Date.now()-3e5},{type:"ai_consult",content:"用户 139****1234 发起了AI健康咨询",timestamp:Date.now()-12e5},{type:"service",content:"用户 158****8888 预约了体检服务",timestamp:Date.now()-36e5},{type:"system",content:"系统维护完成，版本升级至 v1.2.0",timestamp:Date.now()-864e5}]),C=y(!1);let d=null,u=null,v=null;const k=y(null),D=y(null),S=y(null),M=async()=>{C.value=!0;try{console.log("开始加载仪表盘数据...");let s=!1;try{const t=await it.admin.getCount();if(console.log("API响应数据:",t),t&&(t.code===1||t.code===200)){const l=t.data;i.totalUsers=l.userCount||8,i.totalAIConsults=l.aiConsultCount||0,i.totalDepartments=l.departmentCount||5,i.totalEmployees=l.employeeCount||7,i.todayActiveUsers=l.todayActiveUsers||0,i.totalServices=l.totalServices||6,s=!0,console.log("成功从API获取最新数据")}}catch(t){console.warn("API调用失败，使用模拟数据:",t.message)}s||(console.log("使用本地模拟数据替代API调用"),i.totalUsers=8,i.totalAIConsults=0,i.totalDepartments=5,i.totalEmployees=7,i.todayActiveUsers=0,i.totalServices=6),p.value=E()}catch(s){console.error("加载仪表盘数据时发生异常:",s),i.totalUsers=8,i.totalAIConsults=0,i.totalDepartments=5,i.totalEmployees=7,i.todayActiveUsers=0,i.totalServices=6,(!p.value||p.value.length===0)&&(p.value=E())}finally{C.value=!1,console.log("加载仪表盘数据完成")}},Y=()=>{M()},j=s=>{const t=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${t}年${l}月${n}日`},J=s=>{const t=new Date(s),l=String(t.getMonth()+1),n=String(t.getDate());return`${l}/${n}`},Q=s=>{const t=new Date(s),l=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),f=String(t.getHours()).padStart(2,"0"),x=String(t.getMinutes()).padStart(2,"0");return`${l}-${n}-${r} ${f}:${x}`},X=s=>{switch(s){case"login":return"primary";case"service":return"success";case"ai_consult":return"info";case"system":return"warning";default:return"default"}},G=s=>{switch(s){case"login":return"登录";case"service":return"服务";case"ai_consult":return"AI咨询";case"system":return"系统";default:return"其他"}},R=s=>{try{const t=s.querySelector(".el-empty");t&&(t.style.display="none"),d&&(d.dispose(),d=null),s.style.height="100%",s.style.width="100%",s.style.position="relative",d=P(s,null,{renderer:"canvas",useDirtyRect:!1}),console.log("饼图实例创建成功:",d),console.log("饼图数据:",w.value);const l={tooltip:{trigger:"item"},legend:{top:"5%",left:"center"},series:[{name:"服务类型",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,padAngle:5,itemStyle:{borderRadius:10},label:{show:!0,position:"center"},emphasis:{label:{show:!0,fontSize:36,fontWeight:"bold"}},labelLine:{show:!0},data:w.value}]};d.setOption(l),console.log("饼图选项设置成功"),setTimeout(()=>{d&&(s.style.width="400%",s.style.height="300px",d.resize())},0)}catch(t){console.error("初始化饼图失败:",t)}},$=()=>{if(console.log("开始初始化饼图..."),!w.value||w.value.length===0){console.warn("饼图数据为空，跳过初始化");return}D.value?(console.log("饼图容器元素存在，准备初始化..."),R(D.value)):(console.warn("饼图容器元素暂不存在，等待下一个渲染周期..."),A(()=>{D.value?R(D.value):console.error("饼图容器元素仍然不存在")}))},B=s=>{try{const t=s.querySelector(".el-empty");t&&(t.style.display="none"),u&&(u.dispose(),u=null),s.style.height="100%",s.style.width="100%",s.style.position="relative",u=P(s,null,{renderer:"canvas",useDirtyRect:!1}),console.log("柱状图实例创建成功:",u);const l=g.value.map(f=>J(f.date)),n=g.value.map(f=>f.value);console.log("柱状图数据 - 日期:",l),console.log("柱状图数据 - 数值:",n);const r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:l,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"活跃用户",type:"bar",barWidth:"60%",data:n,itemStyle:{color:"#409eff"}}]};u.setOption(r),console.log("柱状图选项设置成功"),setTimeout(()=>{u&&(s.style.width="400%",s.style.height="300px",u.resize())},0)}catch(t){console.error("初始化柱状图失败:",t)}},O=()=>{if(console.log("开始初始化柱状图..."),!g.value||g.value.length===0){console.warn("柱状图数据为空，跳过初始化");return}k.value?(console.log("柱状图容器元素存在，准备初始化..."),B(k.value)):(console.warn("柱状图容器元素暂不存在，等待下一个渲染周期..."),A(()=>{k.value?B(k.value):console.error("柱状图容器元素仍然不存在")}))},W=()=>{d&&d.resize(),u&&u.resize(),v&&v.resize()},K=()=>{d&&(d.dispose(),d=null)},Z=()=>{u&&(u.dispose(),u=null)},N=()=>{if(console.log("开始初始化部门人员分布图表..."),!p.value||p.value.length===0){console.warn("部门数据为空，跳过初始化");return}if(S.value){console.log("部门人员分布图表容器元素存在，准备初始化...");try{const s=S.value.querySelector(".el-empty");s&&(s.style.display="none"),v&&(v.dispose(),v=null),S.value.style.height="350px",S.value.style.width="400%",v=P(S.value,null,{renderer:"canvas",useDirtyRect:!1});const t=p.value.map(r=>r.name),l=p.value.map(r=>r.count),n={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}: {c} 人"},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:t,axisLabel:{interval:0,rotate:45,formatter:r=>r.length>6?r.substring(0,6)+"...":r}},yAxis:{type:"value",name:"人数",axisLabel:{formatter:"{value}"}},series:[{data:l,type:"bar",itemStyle:{color:"#67c23a",borderRadius:[4,4,0,0]},barWidth:"50%",emphasis:{itemStyle:{color:"#85ce61"}}}]};v.setOption(n),setTimeout(()=>{v&&v.resize()},0)}catch(s){console.error("初始化部门人员分布图表失败:",s)}}else console.warn("部门人员分布图表容器元素暂不存在，等待下一个渲染周期..."),A(()=>{N()})};return q(w,()=>{console.log("饼图数据发生变化，准备重新初始化..."),setTimeout(()=>{A(()=>{$()})},50)},{deep:!0}),q(g,()=>{console.log("柱状图数据发生变化，准备重新初始化..."),setTimeout(()=>{A(()=>{O()})},50)},{deep:!0}),dt(()=>{console.log("组件已挂载，开始初始化图表..."),M().then(()=>{A(()=>{console.log("尝试初始化图表..."),O(),$(),N()})}),window.addEventListener("resize",W)}),ut(()=>{K(),Z(),v&&v.dispose(),window.removeEventListener("resize",W)}),(s,t)=>{const l=b("el-icon"),n=b("el-card"),r=b("el-col"),f=b("el-row"),x=b("el-empty"),tt=b("el-button"),et=b("el-tag");return c(),_("div",_t,[e("div",mt,[t[0]||(t[0]=e("h2",null,"欢迎回来，管理员",-1)),e("p",null,"今天是"+m(j(new Date))+"，以下是系统概览",1)]),e("div",ht,[a(f,{gutter:20},{default:o(()=>[a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",ft,[e("div",yt,[a(l,null,{default:o(()=>[a(h(V))]),_:1})]),e("div",gt,[e("div",wt,m(i.totalUsers||0),1),t[1]||(t[1]=e("div",{class:"stat-label"},"总用户数",-1))])])]),_:1})]),_:1}),a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",bt,[e("div",St,[a(l,null,{default:o(()=>[a(h(at))]),_:1})]),e("div",xt,[e("div",At,m(i.totalServices||0),1),t[2]||(t[2]=e("div",{class:"stat-label"},"总服务数",-1))])])]),_:1})]),_:1}),a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",Ct,[e("div",kt,[a(l,null,{default:o(()=>[a(h(ot))]),_:1})]),e("div",Dt,[e("div",Tt,m(i.totalAIConsults||0),1),t[3]||(t[3]=e("div",{class:"stat-label"},"AI咨询次数",-1))])])]),_:1})]),_:1}),a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",It,[e("div",zt,[a(l,null,{default:o(()=>[a(h(lt))]),_:1})]),e("div",Pt,[e("div",Ut,m(i.todayActiveUsers||0),1),t[4]||(t[4]=e("div",{class:"stat-label"},"今日活跃用户",-1))])])]),_:1})]),_:1}),a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",Et,[e("div",Lt,[a(l,null,{default:o(()=>[a(h(V))]),_:1})]),e("div",Mt,[e("div",Rt,m(i.totalEmployees||0),1),t[5]||(t[5]=e("div",{class:"stat-label"},"员工总数",-1))])])]),_:1})]),_:1}),a(r,{xs:12,sm:12,md:6},{default:o(()=>[a(n,{class:"stat-card",shadow:"hover"},{default:o(()=>[e("div",$t,[e("div",Bt,[a(l,null,{default:o(()=>[a(h(nt))]),_:1})]),e("div",Ot,[e("div",Wt,m(i.totalDepartments||0),1),t[6]||(t[6]=e("div",{class:"stat-label"},"部门总数",-1))])])]),_:1})]),_:1})]),_:1})]),e("div",Nt,[a(f,{gutter:20},{default:o(()=>[a(r,{xs:24,md:12},{default:o(()=>[a(n,{class:"chart-card",shadow:"hover"},{header:o(()=>[...t[7]||(t[7]=[e("div",{class:"card-header"},[e("span",null,"最近7天用户活跃度")],-1)])]),default:o(()=>[e("div",Vt,[C.value?(c(),_("div",qt,[a(l,null,{default:o(()=>[a(h(z))]),_:1}),t[8]||(t[8]=e("span",null,"加载中...",-1))])):(c(),_("div",Ft,[e("div",{ref_key:"activityChartRef",ref:k},[!g.value||g.value.length===0?(c(),I(x,{key:0,description:"暂无数据"})):U("",!0)],512)]))])]),_:1})]),_:1}),a(r,{xs:24,md:12},{default:o(()=>[a(n,{class:"chart-card",shadow:"hover"},{header:o(()=>[...t[9]||(t[9]=[e("div",{class:"card-header"},[e("span",null,"服务类型分布")],-1)])]),default:o(()=>[e("div",Ht,[C.value?(c(),_("div",Yt,[a(l,null,{default:o(()=>[a(h(z))]),_:1}),t[10]||(t[10]=e("span",null,"加载中...",-1))])):(c(),_("div",jt,[e("div",{ref_key:"serviceTypePieChartRef",ref:D},[!w.value||w.value.length===0?(c(),I(x,{key:0,description:"暂无数据"})):U("",!0)],512)]))])]),_:1})]),_:1}),a(r,{xs:24,md:24},{default:o(()=>[a(n,{class:"chart-card",shadow:"hover"},{header:o(()=>[...t[11]||(t[11]=[e("div",{class:"card-header"},[e("span",null,"部门人员分布")],-1)])]),default:o(()=>[e("div",Jt,[C.value?(c(),_("div",Qt,[a(l,null,{default:o(()=>[a(h(z))]),_:1}),t[12]||(t[12]=e("span",null,"加载中...",-1))])):(c(),_("div",Xt,[e("div",{ref_key:"departmentStaffChart",ref:S},[!p.value||p.value.length===0?(c(),I(x,{key:0,description:"暂无数据"})):U("",!0)],512)]))])]),_:1})]),_:1})]),_:1})]),e("div",Gt,[a(n,{class:"activities-card",shadow:"hover"},{header:o(()=>[e("div",Kt,[t[14]||(t[14]=e("span",null,"系统最新动态",-1)),a(tt,{type:"text",size:"small",onClick:Y},{default:o(()=>[...t[13]||(t[13]=[F("刷新",-1)])]),_:1})])]),default:o(()=>[e("div",Zt,[L.value.length===0?(c(),I(x,{key:0,description:"暂无动态"})):(c(),_("div",te,[(c(!0),_(vt,null,pt(L.value,(T,st)=>(c(),_("div",{key:st,class:"activity-item"},[e("div",ee,[a(et,{type:X(T.type)},{default:o(()=>[F(m(G(T.type)),1)]),_:2},1032,["type"])]),e("div",se,[e("div",ae,m(T.content),1),e("div",oe,m(Q(T.timestamp)),1)])]))),128))]))])]),_:1})])])}}},ve=rt(le,[["__scopeId","data-v-01ddc2b7"]]);export{ve as default};
