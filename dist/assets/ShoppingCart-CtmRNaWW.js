import{r as y,h as K,c as q,z as f,B as a,L as G,R as l,J as c,al as v,K as H,ar as W,I as X,E as B,P as d,Q as Y,a5 as Z,aB as ee,A as _,O as u}from"./vendor-DdeEpjzh.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as i,b as C}from"./element-DkRX-ly5.js";const ae={class:"shopping-cart"},oe={class:"cart-container"},ne={class:"cart-header"},se={class:"cart-content"},le={key:0,class:"empty-cart"},ce={key:1,class:"cart-items"},re={class:"product-info"},ie={class:"product-image-container"},de=["src","alt","onClick"],ue={class:"product-details"},pe=["onClick"],me={class:"product-specs"},ve={class:"product-actions"},_e={class:"price"},ge={class:"subtotal price"},he={class:"cart-actions"},fe={class:"left-actions"},ye={class:"right-actions"},be={class:"total-section"},ke={class:"total-info"},Ce={class:"total-price"},xe={class:"total-quantity"},we={class:"checkout-section"},qe={key:0,class:"recommendations"},$e={class:"recommend-list"},Be=["onClick"],Ie={class:"recommend-image"},Te=["src","alt"],Se={class:"recommend-info"},Ve={class:"recommend-name"},je={class:"recommend-price"},De={__name:"ShoppingCart",setup(Pe){const x=ee(),w=y(!1),r=y([]),p=y(!1),n=y([]),I=y([{id:3,name:"家用血糖仪套装精准测血糖仪器",price:199,image:"/images/products/blood-sugar.jpg"},{id:5,name:"智能手环心率血压监测运动计步器",price:199,image:"/images/products/fitness-band.jpg"},{id:7,name:"家用制氧机老人氧气机",price:2499,image:"/images/products/oxygen.jpg"},{id:9,name:"医用红外额温枪电子体温计",price:129,image:"/images/products/thermometer.jpg"}]);K(()=>{T()});const T=async()=>{w.value=!0;try{r.value=S(),n.value=[...r.value],p.value=r.value.length>0}catch(t){console.error("加载购物车失败",t),i.error("加载购物车失败，请重试")}finally{w.value=!1}},S=()=>[{id:1,productId:1,name:"智能血压计家用上臂式全自动测量仪",image:"/images/products/blood-pressure.jpg",price:299,quantity:1,specs:{颜色:"白色",型号:"BP-3000"},subtotal:299},{id:2,productId:2,name:"家用血糖仪套装精准测血糖仪器",image:"/images/products/blood-sugar.jpg",price:199,quantity:2,specs:{规格:"50试纸",品牌:"健康卫士"},subtotal:398}],V=q(()=>n.value.reduce((t,e)=>t+e.price*e.quantity,0)),j=q(()=>r.value.reduce((t,e)=>t+e.price*e.quantity,0)),D=q(()=>r.value.reduce((t,e)=>t+e.quantity,0)),P=t=>{n.value=t,p.value=t.length===r.value.length&&t.length>0,t.length>0&&i.info(`已选择 ${t.length} 件商品`)},z=()=>{p.value?n.value=[...r.value]:n.value=[]},A=async(t,e)=>{try{const s=t.quantity;t.quantity=e,t.subtotal=t.price*e,i.success(`已将 "${t.name}" 数量更新为 ${e}`)}catch(s){console.error("更新数量失败",s),i.error("更新失败，请重试"),t.quantity=t.oldQuantity||t.quantity,t.subtotal=t.price*t.quantity}},E=async t=>{try{await C.confirm(`确定要删除 "${t.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=r.value.findIndex(s=>s.id===t.id);e>-1&&r.value.splice(e,1),n.value=n.value.filter(s=>s.id!==t.id),p.value=n.value.length===r.value.length,i.success(`已删除 "${t.name}"`)}catch(e){e!=="cancel"&&(console.error("删除失败",e),i.error("删除失败，请重试"))}},M=async()=>{if(n.value.length===0){i.warning("请选择要删除的商品");return}try{await C.confirm(`确定要删除选中的 ${n.value.length} 件商品吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=n.value.map(s=>s.id),e=n.value.length;r.value=r.value.filter(s=>!t.includes(s.id)),n.value=[],p.value=!1,i.success(`已成功删除 ${e} 件商品`)}catch(t){t!=="cancel"&&(console.error("批量删除失败",t),i.error("删除失败，请重试"))}},N=async()=>{try{await C.confirm("确定要清空购物车吗？","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=[],n.value=[],p.value=!1,i.success("购物车已清空")}catch(t){t!=="cancel"&&(console.error("清空购物车失败",t),i.error("操作失败，请重试"))}},F=async()=>{if(n.value.length===0){i.warning("请选择要结算的商品");return}try{const t=n.value.reduce((s,k)=>s+k.price*k.quantity,0);await C.confirm(`确认结算 ${n.value.length} 件商品，合计金额：¥${t.toFixed(2)}？`,"确认结算",{confirmButtonText:"确认结算",cancelButtonText:"取消",type:"primary"});const e={items:n.value.map(s=>({id:s.id,productId:s.productId,quantity:s.quantity,price:s.price,name:s.name})),totalAmount:t};sessionStorage.setItem("checkoutParams",JSON.stringify(e)),x.push("/user/mall/checkout")}catch(t){t!=="cancel"&&(console.error("结算失败",t),i.error("操作失败，请重试"))}},$=()=>{x.push("/user/mall")},b=t=>{x.push(`/user/mall/product/${t}`)},O=t=>t?Object.entries(t).map(([e,s])=>`${e}: ${s}`).join(", "):"";return(t,e)=>{const s=v("el-breadcrumb-item"),k=v("el-breadcrumb"),g=v("el-button"),Q=v("el-empty"),h=v("el-table-column"),U=v("el-input-number"),J=v("el-table"),L=v("el-checkbox"),R=W("loading");return _(),f("div",ae,[e[13]||(e[13]=a("div",{class:"top-decoration"},null,-1)),a("div",oe,[a("div",ne,[e[3]||(e[3]=a("h2",null,"我的购物车",-1)),l(k,{separator:"/"},{default:c(()=>[l(s,{onClick:$},{default:c(()=>[...e[1]||(e[1]=[u("商城首页",-1)])]),_:1}),l(s,null,{default:c(()=>[...e[2]||(e[2]=[u("购物车",-1)])]),_:1})]),_:1})]),a("div",se,[r.value.length===0?(_(),f("div",le,[l(Q,{description:"购物车是空的","image-size":200},{description:c(()=>[...e[4]||(e[4]=[u(" 快去选购心仪的商品吧 ",-1)])]),default:c(()=>[l(g,{type:"primary",onClick:$},{default:c(()=>[...e[5]||(e[5]=[u("去购物",-1)])]),_:1})]),_:1})])):(_(),f("div",ce,[H((_(),X(J,{data:r.value,style:{width:"100%"},border:"",onSelectionChange:P},{default:c(()=>[l(h,{type:"selection",width:"55"}),l(h,{prop:"name",label:"商品信息","min-width":"300"},{default:c(o=>[a("div",re,[a("div",ie,[a("img",{src:o.row.image,alt:o.row.name,class:"product-image",onClick:m=>b(o.row.productId)},null,8,de)]),a("div",ue,[a("div",{class:"product-name",onClick:m=>b(o.row.productId)},d(o.row.name),9,pe),a("div",me,d(O(o.row.specs)),1),a("div",ve,[l(g,{size:"small",type:"link",onClick:m=>b(o.row.productId)},{default:c(()=>[...e[6]||(e[6]=[u("查看详情",-1)])]),_:1},8,["onClick"])])])])]),_:1}),l(h,{prop:"price",label:"单价",width:"120",align:"center"},{default:c(o=>[a("span",_e,"¥"+d(o.row.price),1)]),_:1}),l(h,{prop:"quantity",label:"数量",width:"180",align:"center"},{default:c(o=>[l(U,{modelValue:o.row.quantity,"onUpdate:modelValue":m=>o.row.quantity=m,min:1,max:99,size:"small",class:"quantity-input",onChange:m=>A(o.row,m),"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(h,{prop:"subtotal",label:"小计",width:"120",align:"center"},{default:c(o=>[a("span",ge,"¥"+d(o.row.subtotal),1)]),_:1}),l(h,{label:"操作",width:"100",align:"center"},{default:c(o=>[l(g,{type:"text",danger:"",onClick:m=>E(o.row)},{default:c(()=>[...e[7]||(e[7]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,w.value]]),a("div",he,[a("div",fe,[l(L,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),onChange:z,class:"all-select-checkbox"},{default:c(()=>[...e[8]||(e[8]=[a("span",{class:"checkbox-text"},"全选",-1)])]),_:1},8,["modelValue"]),l(g,{type:"text",onClick:M,disabled:n.value.length===0,class:B(["batch-delete-btn",{disabled:n.value.length===0}])},{default:c(()=>[...e[9]||(e[9]=[u(" 批量删除 ",-1)])]),_:1},8,["disabled","class"]),l(g,{type:"text",onClick:N,class:"clear-cart-btn"},{default:c(()=>[...e[10]||(e[10]=[u(" 清空购物车 ",-1)])]),_:1})]),a("div",ye,[a("div",be,[a("div",ke,[e[11]||(e[11]=a("span",{class:"total-text"},"合计：",-1)),a("span",Ce,"¥"+d((n.value.length>0?V.value:j.value).toFixed(2)),1)]),a("div",xe,"共 "+d(D.value)+" 件商品",1)]),a("div",we,[l(g,{type:"primary",onClick:F,disabled:n.value.length===0,class:B(["checkout-button",{active:n.value.length>0}])},{default:c(()=>[u(" 结算 ("+d(n.value.length)+") ",1)]),_:1},8,["disabled","class"])])])])]))])]),r.value.length>0?(_(),f("div",qe,[e[12]||(e[12]=a("h3",{class:"recommend-title"},"猜你喜欢",-1)),a("div",$e,[(_(!0),f(Y,null,Z(I.value,o=>(_(),f("div",{key:o.id,class:"recommend-item",onClick:m=>b(o.id)},[a("div",Ie,[a("img",{src:o.image,alt:o.name},null,8,Te)]),a("div",Se,[a("div",Ve,d(o.name),1),a("div",je,"¥"+d(o.price),1)])],8,Be))),128))])])):G("",!0)])}}},Me=te(De,[["__scopeId","data-v-778bb734"]]);export{Me as default};
